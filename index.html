<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LMS — Intro</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Inter:wght@300;400;500&display=swap');
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:#05070d;color:#e8eefc;overflow:hidden}

  #intro{
    position:fixed; inset:0;
    background:
      radial-gradient(1200px 700px at 50% 40%, rgba(106,167,255,.12), transparent 55%),
      radial-gradient(900px 650px at 70% 70%, rgba(120,255,204,.06), transparent 55%),
      #05070d;
    display:flex; align-items:center; justify-content:center;
    z-index:10;
    transition: opacity 1.1s ease;
  }

  #stage{
    position:absolute; inset:0;
    perspective: 950px;
    transform-style: preserve-3d;
    overflow:hidden;
    pointer-events:none;
    /* оптимізація */
    contain: layout paint;
  }
  #cloud{
    position:absolute; inset:0;
    transform-style: preserve-3d;
    pointer-events:none;
    transform: translateZ(0); /* GPU hint */
  }

  .intro-content{
    position:relative; z-index:3;
    text-align:center;
    width:min(980px,92vw);
    padding:24px;
    pointer-events:none;
  }
  .intro-content h1{
    font-family:"Cormorant Garamond", serif;
    font-weight:500;
    margin:0 0 14px;
    letter-spacing:.01em;
    font-size:clamp(46px,6.2vw,92px);
    line-height:1.02;
  }
  .intro-content p{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    margin:0 0 30px;
    opacity:.72;
    line-height:1.65;
    font-size:clamp(13px,1.45vw,16px);
  }
  #enterBtn{
    pointer-events:auto;
    opacity:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    font-weight:400;
    padding:12px 30px;
    background:transparent;
    border:1px solid rgba(255,255,255,.35);
    color:#e8eefc;
    letter-spacing:.18em;
    text-transform:uppercase;
    cursor:pointer;
    transition:opacity 1.2s ease,border-color .3s ease,transform .25s ease;
    user-select:none;
  }
  #enterBtn:hover{border-color:#fff;transform:translateY(-1px)}

  .year{
    position:absolute; left:0; top:0;
    transform-style:preserve-3d;
    will-change: transform, opacity;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    letter-spacing:.12em;
    color: rgba(232,238,252,.95);
    white-space:nowrap;
    user-select:none;
    pointer-events:none;
    text-shadow: 0 0 14px rgba(0,0,0,.55);
  }

  /* Під час вихору: відрубаємо важкі ефекти */
  .vortex .year{
    text-shadow:none !important;
    filter:none !important;
  }

  /* MAP */
  #wrap{position:fixed;inset:0;opacity:0;pointer-events:none;transition:opacity 1s ease;z-index:1}
  #space{
    position:absolute; left:50%; top:50%;
    width:3000px; height:2000px;
    transform: translate(-50%,-50%) scale(1);
    background:
      radial-gradient(800px 400px at 30% 30%, rgba(106,167,255,.15), transparent 50%),
      radial-gradient(700px 500px at 70% 60%, rgba(120,255,204,.10), transparent 45%);
  }
  .node{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%);
    width:28px; height:28px; border-radius:50%;
    background:#6aa7ff;
    box-shadow:0 0 24px rgba(106,167,255,.6);
    cursor:pointer;
  }
  .label{
    position:absolute; top:36px; left:50%;
    transform:translateX(-50%);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    font-size:12px; opacity:.85;
    white-space:nowrap;
  }

  /* DEMO */
  #scene{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#05070d;z-index:20}
  .card{
    max-width:720px;
    padding:28px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.15);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    text-align:center;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  }
  .close-btn{
    margin-top:24px;
    padding:10px 22px;
    background:transparent;
    border:1px solid rgba(255,255,255,.35);
    color:#e8eefc;
    cursor:pointer;
    letter-spacing:.06em;
    user-select:none;
  }
  .hint{position:fixed;left:16px;bottom:16px;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;font-size:12px;opacity:.6;z-index:5;user-select:none}
</style>
</head>

<body>
<div id="intro">
  <div id="stage"><div id="cloud"></div></div>
  <div class="intro-content" id="center">
    <h1>Навчання — це подорож</h1>
    <p>Перед тобою історія курсу.<br>Це лише вступ. Далі — глибше.</p>
    <button id="enterBtn">ENTER</button>
  </div>
</div>

<div id="wrap">
  <div id="space">
    <div class="node" id="demoNode"><div class="label">Демо-урок</div></div>
  </div>
</div>

<div id="scene">
  <div class="card">
    <h2>Демо-урок</h2>
    <p>Це приклад формату навчання.<br>Повний шлях відкривається після входу.</p>
    <button class="close-btn" id="closeScene">Повернутись</button>
  </div>
</div>

<div class="hint">ENTER → “вихор” → карта · На карті: перетягуй · Коліщатко — zoom</div>

<script>
function makeYears(start,end){ const out=[]; for(let y=start;y<=end;y++) out.push(String(y)); return out; }
const YEARS_ALL = makeYears(1800, 2024);
const LIMIT = 170;
const YEARS = YEARS_ALL.slice(0, LIMIT);

/* ====== TUNING ====== */
const ORBIT_COUNT = 56;
const SAFE_RADIUS_K = 0.23;
const ORBIT_RADIUS_K = 0.36;
const FOG_RADIUS_K = 0.52;
const SPEED = 0.055;

/* ====== PERFORMANCE: how many items animate during vortex ======
   1.0 = всі (важко), 0.6 = легше, 0.4 = ще легше
*/
const VORTEX_ACTIVE_RATIO = 0.55;

const cloud = document.getElementById('cloud');
const stage = document.getElementById('stage');
const centerEl = document.getElementById('center');
const enterBtn = document.getElementById('enterBtn');
const intro = document.getElementById('intro');
const wrap = document.getElementById('wrap');

function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
function easeInOutCubic(x){ return x<0.5 ? 4*x*x*x : 1-Math.pow(-2*x+2,3)/2; }

let vortex=false, vortexStart=0;
let rot=0;

setTimeout(()=>{ enterBtn.style.opacity='1'; enterBtn.style.pointerEvents='auto'; }, 2000);

enterBtn.addEventListener('click', ()=>{
  if(vortex) return;
  vortex=true;
  vortexStart=performance.now();
  stage.classList.add('vortex'); // вимкнути важкі ефекти
});

const items = YEARS.map((y,i)=>{
  const el=document.createElement('div');
  el.className='year';
  el.textContent=y;
  cloud.appendChild(el);

  const orbit = i < ORBIT_COUNT;
  const a0 = (i/(orbit?ORBIT_COUNT:YEARS.length))*Math.PI*2 + (Math.random()*0.10);

  return{
    el, orbit,
    a:a0,
    s:(0.45+Math.random()*0.55)*(Math.random()<0.5?-1:1),
    ph:Math.random()*Math.PI*2,
    z0: orbit ? (-60+Math.random()*140) : (-320+Math.random()*420),
    jx:(Math.random()*120-60),
    jy:(Math.random()*90-45),
    frozen:false,
    lastX:0,lastY:0,lastZ:0,lastScale:1,lastOp:0.1,lastFont:12
  };
});

// determine which items are "active" in vortex once (stable)
const vortexActiveCount = Math.floor(items.length * VORTEX_ACTIVE_RATIO);
const vortexActiveSet = new Set();
for(let i=0;i<vortexActiveCount;i++) vortexActiveSet.add(i); // перші N активні (в т.ч. orbit)

let last=performance.now();
function tick(now){
  const dt=(now-last)/1000; last=now;

  const rect=centerEl.getBoundingClientRect();
  const cx=rect.left+rect.width/2;
  const cy=rect.top+rect.height/2;

  const minSide=Math.min(window.innerWidth, window.innerHeight);
  const SAFE = clamp(minSide*SAFE_RADIUS_K, 140, 240);
  const R_ORB = clamp(minSide*ORBIT_RADIUS_K, 280, 520);
  const R_FOG = clamp(minSide*FOG_RADIUS_K, 420, 820);

  const p=vortex ? clamp((now-vortexStart)/1500,0,1) : 0;
  const pe=easeInOutCubic(p);

  rot += SPEED*dt*0.25;

  items.forEach((it,idx)=>{
    const vortexActive = !vortex || vortexActiveSet.has(idx);

    // if vortex and not active => keep last transform/opacity (saves CPU)
    if(vortex && !vortexActive){
      it.el.style.transform =
        `translate3d(${it.lastX}px, ${it.lastY}px, ${it.lastZ}px) translate(-50%,-50%) scale(${it.lastScale})`;
      it.el.style.opacity = it.lastOp;
      return;
    }

    it.a += (SPEED*0.35)*dt*it.s;
    const spinBoost = vortex ? (1 + pe*10.0) : 1;
    const a = (it.a + rot) * spinBoost;

    let r = it.orbit ? R_ORB : R_FOG;

    const breathe = Math.sin(now*0.00045 + it.ph) * (it.orbit ? 10 : 18);
    let x = Math.cos(a) * (r + breathe);
    let y = Math.sin(a) * (r + breathe) * 0.70;

    if(!it.orbit){
      x += Math.sin(now*0.00018 + it.ph) * 28 + it.jx*0.10;
      y += Math.cos(now*0.00016 + it.ph) * 18 + it.jy*0.10;
    }

    const dist = Math.hypot(x,y);
    if(dist < SAFE){
      const k = SAFE / Math.max(1, dist);
      x *= k; y *= k;
    }

    const zIdle = it.z0 + Math.sin(now*0.00033 + it.ph) * (it.orbit ? 18 : 34);
    const z = vortex ? (zIdle + pe*(1200 + idx*2)) : zIdle;

    const zNorm = clamp((z + 360)/1100, 0, 1);

    // IMPORTANT: do NOT change fontSize during vortex (expensive layout)
    const font = it.orbit ? (13 + zNorm*4) : (10 + zNorm*2);
    if(!vortex){
      it.el.style.fontSize = font.toFixed(1)+'px';
      it.lastFont = font;
      // restore glow outside vortex
      it.el.style.textShadow = it.orbit
        ? '0 0 26px rgba(106,167,255,.22), 0 0 16px rgba(0,0,0,.55)'
        : '0 0 14px rgba(0,0,0,.55)';
    }

    const scale = it.orbit ? (1.00 + zNorm*0.75) : (0.75 + zNorm*0.55);

    const opacity = it.orbit
      ? clamp(0.32 + zNorm*0.55, 0.22, 0.88)
      : clamp(0.04 + zNorm*0.24, 0.02, 0.34);

    // during vortex: no filter blur (heavy)
    if(!vortex){
      it.el.style.filter = 'none';
    }

    const tx = cx + x;
    const ty = cy + y;

    it.el.style.opacity = opacity.toFixed(3);
    it.el.style.transform =
      `translate3d(${tx}px, ${ty}px, ${z}px) translate(-50%,-50%) scale(${scale})`;

    // cache last
    it.lastX = tx; it.lastY = ty; it.lastZ = z;
    it.lastScale = scale; it.lastOp = opacity.toFixed(3);
  });

  if(vortex && p>=1){
    stage.classList.remove('vortex'); // прибрати клас
    intro.style.opacity='0';
    setTimeout(()=>{
      intro.style.display='none';
      wrap.style.opacity='1';
      wrap.style.pointerEvents='auto';
    }, 900);
    vortex=false;
    return;
  }

  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);

/* MAP pan/zoom + demo */
const space=document.getElementById('space');
let scale=1, mx=0, my=0, drag=false, sx=0, sy=0;
function apply(){ space.style.transform=`translate(${mx}px, ${my}px) scale(${scale})`; }
wrap.addEventListener('mousedown', e=>{ drag=true; sx=e.clientX-mx; sy=e.clientY-my; });
window.addEventListener('mouseup', ()=>drag=false);
window.addEventListener('mousemove', e=>{ if(!drag) return; mx=e.clientX-sx; my=e.clientY-sy; apply(); });
wrap.addEventListener('wheel', e=>{
  e.preventDefault();
  scale *= e.deltaY>0 ? 0.9 : 1.1;
  scale = Math.max(0.4, Math.min(2.5, scale));
  apply();
},{passive:false});

const scene=document.getElementById('scene');
document.getElementById('demoNode').onclick=()=>scene.style.display='flex';
document.getElementById('closeScene').onclick=()=>scene.style.display='none';
</script>
</body>
</html>
