<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LMS Map — Demo</title>

<style>
  *{box-sizing:border-box}
  html,body{
    margin:0; padding:0; height:100%;
    background:#05070d; color:#e8eefc;
    font-family: system-ui, -apple-system, Segoe UI, Roboto;
    overflow:hidden;
  }

  /* =============== INTRO =============== */
  #intro{
    position:fixed; inset:0;
    background:
      radial-gradient(1200px 700px at 50% 40%, rgba(106,167,255,.10), transparent 55%),
      radial-gradient(900px 600px at 70% 70%, rgba(120,255,204,.06), transparent 50%),
      #05070d;
    display:flex; align-items:center; justify-content:center;
    z-index:10;
    transition:opacity 1.2s ease;
  }

  /* 3D stage (light) */
  #stage{
    position:absolute; inset:0;
    perspective: 900px;
    transform-style:preserve-3d;
    overflow:hidden;
  }

  /* floating dates container */
  #dates{
    position:absolute; inset:0;
    transform-style:preserve-3d;
    pointer-events:none;
  }

  /* center copy */
  .intro-content{
    position:relative;
    z-index:3;
    text-align:center;
    width:min(860px, 92vw);
    padding:20px;
    pointer-events:none;
  }
  .intro-content h1{
    margin:0 0 14px;
    font-weight:600;
    letter-spacing:.02em;
    font-size: clamp(30px, 4.2vw, 52px);
    line-height:1.15;
    text-wrap: balance;
  }
  .intro-content p{
    margin:0 0 30px;
    opacity:.72;
    line-height:1.6;
    font-size: clamp(13px, 1.4vw, 16px);
  }

  /* Enter */
  #enterBtn{
    pointer-events:auto;
    opacity:0;
    padding:12px 30px;
    background:transparent;
    border:1px solid rgba(255,255,255,.35);
    color:#e8eefc;
    letter-spacing:.14em;
    text-transform:uppercase;
    cursor:pointer;
    transition:opacity 1.2s ease, border-color .3s ease, transform .25s ease;
  }
  #enterBtn:hover{ border-color:#fff; transform:translateY(-1px); }

  /* Each date bubble */
  .bubble{
    position:absolute;
    left:50%; top:50%;
    width: 92px; height: 92px;
    margin-left:-46px; margin-top:-46px;
    border-radius:50%;
    border:1px solid rgba(255,255,255,.14);
    background: radial-gradient(60px 60px at 30% 30%, rgba(255,255,255,.05), transparent 65%);
    box-shadow: 0 0 40px rgba(106,167,255,.08), inset 0 0 18px rgba(255,255,255,.04);
    backdrop-filter: blur(2px);
    transform-style:preserve-3d;
    will-change: transform, opacity, filter;
    opacity:.85;
  }
  .bubble::after{
    content:"";
    position:absolute; inset:10px;
    border-radius:50%;
    border:1px dashed rgba(255,255,255,.07);
    opacity:.6;
  }
  .bubble .t{
    position:absolute; inset:0;
    display:flex; align-items:center; justify-content:center;
    font-size:12px;
    letter-spacing:.08em;
    opacity:.55;
  }

  /* =============== MAP =============== */
  #wrap{
    position:fixed; inset:0;
    opacity:0; pointer-events:none;
    transition:opacity 1s ease;
    z-index:1;
  }
  #space{
    position:absolute; left:50%; top:50%;
    width:3000px; height:2000px;
    transform:translate(-50%,-50%) scale(1);
    background:
      radial-gradient(800px 400px at 30% 30%, rgba(106,167,255,.15), transparent 50%),
      radial-gradient(700px 500px at 70% 60%, rgba(120,255,204,.10), transparent 45%);
  }
  .node{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%);
    width:28px; height:28px; border-radius:50%;
    background:#6aa7ff;
    box-shadow:0 0 24px rgba(106,167,255,.6);
    cursor:pointer;
  }
  .label{
    position:absolute; top:36px; left:50%;
    transform:translateX(-50%);
    font-size:12px; opacity:.85;
    white-space:nowrap;
  }

  /* =============== DEMO SCENE =============== */
  #scene{
    position:fixed; inset:0;
    display:none; align-items:center; justify-content:center;
    background:#05070d;
    z-index:20;
  }
  .card{
    max-width:720px;
    padding:28px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.15);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    text-align:center;
  }
  .card h2{margin:0 0 12px}
  .card p{opacity:.85;line-height:1.6;margin:0}
  .close-btn{
    margin-top:24px;
    padding:10px 22px;
    background:transparent;
    border:1px solid rgba(255,255,255,.35);
    color:#e8eefc;
    cursor:pointer;
  }

  .hint{
    position:fixed;
    left:16px; bottom:16px;
    font-size:12px; opacity:.6;
    z-index:5;
  }

  @media (prefers-reduced-motion: reduce){
    .bubble{ transition:none !important; }
  }
</style>
</head>

<body>

<div id="intro">
  <div id="stage">
    <div id="dates"></div>
  </div>

  <div class="intro-content">
    <h1>Навчання — це подорож</h1>
    <p>Перед тобою історія курсу.<br>Це лише вступ. Далі — глибше.</p>
    <button id="enterBtn">ENTER</button>
  </div>
</div>

<div id="wrap">
  <div id="space">
    <div class="node" id="demoNode">
      <div class="label">Демо-урок</div>
    </div>
  </div>
</div>

<div id="scene">
  <div class="card">
    <h2>Демо-урок</h2>
    <p>Це приклад формату навчання.<br>Повний шлях відкривається після входу.</p>
    <button class="close-btn" id="closeScene">Повернутись</button>
  </div>
</div>

<div class="hint">ENTER → карта · На карті: перетягуй · Коліщатко — zoom</div>

<script>
  /* ========== DATA ========== */
  // Тимчасово роки. Потім замінимо на твої справжні “дати/події”.
  const datesList = Array.from({length:30}, (_,i)=> String(1990+i));

  const datesRoot = document.getElementById('dates');

  /* ========== BUILD 30 BUBBLES (1 date = 1 bubble) ========== */
  const bubbles = datesList.map((txt, i) => {
    const el = document.createElement('div');
    el.className = 'bubble';
    const t = document.createElement('div');
    t.className = 't';
    t.textContent = txt;
    el.appendChild(t);
    datesRoot.appendChild(el);

    // stable circular layout params
    const baseA = (i / datesList.length) * Math.PI * 2;
    const ring = (i % 2 === 0) ? 0 : 1; // two rings for depth
    const phase = Math.random() * Math.PI * 2;

    return {
      el,
      a: baseA,
      baseA,
      ring,
      phase,

      // VERY SLOW drift
      // radians per second ~ 0.02..0.05 (slow)
      speed: (0.020 + Math.random()*0.020) * (Math.random() < 0.5 ? -1 : 1),

      // small wobble (px)
      wob: 10 + Math.random()*16,
      wob2: 6 + Math.random()*10,

      // gentle rotation
      rot: (Math.random()*8 - 4),

      // depth baseline
      z0: -80 - ring*60 - Math.random()*70
    };
  });

  /* ========== LAYOUT helpers ========== */
  function getRadius(){
    // radius tied to screen, so it stays around the title and doesn't fly off
    const minSide = Math.min(window.innerWidth, window.innerHeight);
    return Math.max(200, Math.min(380, minSide * 0.34));
  }

  let radius = getRadius();
  window.addEventListener('resize', ()=>{ radius = getRadius(); });

  /* ========== ENTRY / VORTEX ========== */
  const enterBtn = document.getElementById('enterBtn');
  const intro = document.getElementById('intro');
  const wrap = document.getElementById('wrap');

  let vortex = false;
  let vortexStart = 0;

  function easeInOutCubic(x){
    return x < 0.5 ? 4*x*x*x : 1 - Math.pow(-2*x + 2, 3)/2;
  }

  setTimeout(()=>{
    enterBtn.style.opacity = '1';
    enterBtn.style.pointerEvents = 'auto';
  }, 2200);

  enterBtn.addEventListener('click', ()=>{
    if(vortex) return;
    vortex = true;
    vortexStart = performance.now();
  });

  /* ========== ANIMATION LOOP (slow drift) ========== */
  let last = performance.now();

  function tick(now){
    const dt = (now - last) / 1000; // seconds
    last = now;

    const cx = window.innerWidth / 2;
    const cy = window.innerHeight / 2;

    const p = vortex ? Math.min(1, (now - vortexStart) / 1700) : 0;
    const pe = easeInOutCubic(p);

    bubbles.forEach((b, i) => {
      // slow orbit
      b.a += b.speed * dt;

      // two rings slightly different radii
      const ringR = radius + (b.ring ? 70 : 0);

      // gentle wobble so it feels alive (VERY small)
      const wob = Math.sin(now*0.00025 + b.phase) * b.wob;
      const wob2 = Math.cos(now*0.00018 + b.phase*1.7) * b.wob2;

      // vortex: radius shrinks, spin accelerates a bit, Z shoots forward
      const spinBoost = vortex ? (1 + pe*6) : 1;
      const a = b.a * spinBoost;

      const r = vortex ? (ringR + wob) * (1 - pe) : (ringR + wob);
      const x = Math.cos(a) * r + wob2;
      const y = Math.sin(a) * r * 0.70 + wob2*0.6;

      // depth
      const z = vortex
        ? b.z0 + pe * (1000 + i*10)
        : b.z0 + Math.sin(now*0.00035 + b.phase) * 10;

      // scale with depth
      const s = 1 + Math.max(0, z) / 850;

      // subtle fade/blur in vortex (not too aggressive)
      const op = vortex ? (0.85 - pe*0.45) : 0.85;
      const blur = vortex ? (pe*1.8) : 0;

      const rot = b.rot + (vortex ? pe*140 : Math.sin(now*0.00022 + b.phase)*2);

      b.el.style.opacity = op.toFixed(3);
      b.el.style.filter = `blur(${blur}px)`;
      b.el.style.transform =
        `translate3d(${cx + x - 46}px, ${cy + y - 46}px, ${z}px) rotate(${rot}deg) scale(${s})`;
    });

    // finish transition
    if(vortex && p >= 1){
      intro.style.opacity = '0';
      setTimeout(()=>{
        intro.style.display = 'none';
        wrap.style.opacity = '1';
        wrap.style.pointerEvents = 'auto';
      }, 900);
      vortex = false;
      return;
    }

    requestAnimationFrame(tick);
  }

  requestAnimationFrame(tick);

  /* ========== MAP PAN/ZOOM + DEMO SCENE ========== */
  const space = document.getElementById('space');
  let scale=1, mx=0, my=0, drag=false, sx=0, sy=0;

  function apply(){ space.style.transform = `translate(${mx}px, ${my}px) scale(${scale})`; }

  wrap.addEventListener('mousedown', e=>{ drag=true; sx=e.clientX-mx; sy=e.clientY-my; });
  window.addEventListener('mouseup', ()=>drag=false);
  window.addEventListener('mousemove', e=>{
    if(!drag) return;
    mx=e.clientX-sx; my=e.clientY-sy; apply();
  });
  wrap.addEventListener('wheel', e=>{
    e.preventDefault();
    scale *= e.deltaY>0 ? 0.9 : 1.1;
    scale = Math.max(0.4, Math.min(2.5, scale));
    apply();
  }, {passive:false});

  const scene = document.getElementById('scene');
  document.getElementById('demoNode').onclick = ()=> scene.style.display='flex';
  document.getElementById('closeScene').onclick = ()=> scene.style.display='none';
</script>

</body>
</html>
