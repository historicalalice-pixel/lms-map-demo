<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LMS — Intro</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap');
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:#05070d;color:#e8eefc;overflow:hidden}

  /* ===================== INTRO (НЕ ЛАМАЄМО) ===================== */
  #intro{
    position:fixed; inset:0;
    background:
      radial-gradient(1200px 700px at 50% 40%, rgba(106,167,255,.12), transparent 55%),
      radial-gradient(900px 650px at 70% 70%, rgba(120,255,204,.06), transparent 55%),
      #05070d;
    display:flex; align-items:center; justify-content:center;
    z-index:10;
    transition: opacity 1.0s ease;
  }

  #stage{
    position:absolute; inset:0;
    perspective: 980px;
    perspective-origin: 50% 50%;
    transform-style: preserve-3d;
    overflow:hidden;
    pointer-events:none;
    contain: layout paint;
  }
  #cloud{
    position:absolute; inset:0;
    transform-style: preserve-3d;
    pointer-events:none;
    transform: translateZ(0);
    will-change: transform;
  }

  .intro-content{
    position:relative; z-index:3;
    text-align:center;
    width:min(980px,92vw);
    padding:24px;
    pointer-events:none;
    transition: opacity .65s ease, transform .65s ease, filter .65s ease;
  }

  .intro-content h1{
    font-family:"Cormorant Garamond", serif;
    font-weight:500;
    margin:0 0 14px;
    letter-spacing:.01em;
    font-size:clamp(46px,6.2vw,92px);
    line-height:1.02;
  }
  .intro-content p{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    margin:0 0 30px;
    opacity:.72;
    line-height:1.65;
    font-size:clamp(13px,1.45vw,16px);
  }

  #enterBtn{
    pointer-events:auto;
    opacity:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    font-weight:400;
    padding:12px 30px;
    background:transparent;
    border:1px solid rgba(255,255,255,.35);
    color:#e8eefc;
    letter-spacing:.18em;
    text-transform:uppercase;
    cursor:pointer;
    transition:opacity 1.2s ease,border-color .3s ease,transform .25s ease;
    user-select:none;
  }
  #enterBtn:hover{border-color:#fff;transform:translateY(-1px)}

  .year{
    position:absolute; left:0; top:0;
    transform-style:preserve-3d;
    will-change: transform, opacity;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    letter-spacing:.12em;
    color: rgba(232,238,252,.95);
    white-space:nowrap;
    user-select:none;
    pointer-events:none;
    text-shadow: 0 0 14px rgba(0,0,0,.55);
  }

  /* During vortex: cut heavy effects */
  .vortex .year{
    text-shadow:none !important;
    filter:none !important;
  }

  /* Fade center content at vortex start */
  .vortexing .intro-content{
    opacity:0;
    transform: translateY(-10px) scale(0.99);
    filter: blur(1px);
  }

  /* Fade overlay between scenes */
  #fadeOverlay{
    position:fixed; inset:0;
    background:#05070d;
    opacity:0;
    pointer-events:none;
    z-index:15;
    transition: opacity .6s ease;
  }

  /* ===================== MAIN MAP (НОВА ГОЛОВНА) ===================== */
  #wrap{
    position:fixed; inset:0;
    opacity:0;
    pointer-events:none;
    transition:opacity 1s ease;
    z-index:1;
    background:
      radial-gradient(900px 500px at 35% 35%, rgba(106,167,255,.10), transparent 55%),
      radial-gradient(800px 600px at 70% 65%, rgba(120,255,204,.07), transparent 55%),
      #05070d;
  }

  /* Top UI */
  .topbar{
    position:absolute; left:14px; right:14px; top:14px;
    display:flex; align-items:center; justify-content:space-between;
    gap:12px;
    z-index:5;
    pointer-events:none;
  }
  .chip{
    pointer-events:auto;
    display:flex; align-items:center; gap:10px;
    padding:10px 12px;
    border:1px solid rgba(255,255,255,.12);
    border-radius:999px;
    background:rgba(10,12,18,.55);
    backdrop-filter: blur(10px);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  }
  .chip b{font-size:13px; letter-spacing:.02em; font-weight:600}
  .chip span{font-size:12px; opacity:.7}

  /* Viewport for pan/zoom */
  #viewport{
    position:absolute; inset:0;
    overflow:hidden;
    cursor:grab;
  }
  #viewport:active{ cursor:grabbing; }

  /* Big world */
  #world{
    position:absolute;
    left:50%; top:50%;
    width:5200px; height:3400px;
    transform: translate(-50%,-50%) translate(0px,0px) scale(1);
    transform-origin: 0 0;
    will-change: transform;
  }

  /* Subtle dot-grid like a map */
  #world::before{
    content:"";
    position:absolute; inset:0;
    background:
      radial-gradient(circle at 1px 1px, rgba(255,255,255,.06) 1px, transparent 1px);
    background-size: 44px 44px;
    opacity:.22;
    mask-image: radial-gradient(1200px 900px at 50% 50%, rgba(0,0,0,1), transparent 70%);
  }

  /* Paths */
  .path{
    position:absolute; left:0; top:0;
    width:100%; height:100%;
    pointer-events:none;
  }
  .path line{
    stroke: rgba(232,238,252,.12);
    stroke-width: 2;
  }
  .path line.demo-line{
    stroke: rgba(106,167,255,.28);
  }

  /* Nodes */
  .node{
    position:absolute;
    width:14px; height:14px;
    border-radius:999px;
    background:rgba(232,238,252,.85);
    box-shadow: 0 0 0 6px rgba(232,238,252,.05), 0 0 24px rgba(106,167,255,.20);
    transform: translate(-50%,-50%);
    cursor:pointer;
    user-select:none;
  }
  .node.demo{
    background:#6aa7ff;
    box-shadow: 0 0 0 7px rgba(106,167,255,.14), 0 0 34px rgba(106,167,255,.55);
  }
  .node.locked{
    opacity:.35;
    box-shadow: 0 0 0 6px rgba(232,238,252,.03), 0 0 18px rgba(0,0,0,0);
  }

  .node-label{
    position:absolute;
    left:14px; top:50%;
    transform: translateY(-50%);
    white-space:nowrap;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    font-size:12px;
    letter-spacing:.02em;
    color:rgba(232,238,252,.85);
    text-shadow: 0 0 16px rgba(0,0,0,.65);
    pointer-events:none;
  }
  .node-meta{
    display:block;
    font-size:11px;
    opacity:.65;
    margin-top:2px;
  }

  /* DEMO SCENE */
  #scene{
    position:fixed; inset:0;
    display:none;
    align-items:center; justify-content:center;
    background: rgba(5,7,13,.82);
    backdrop-filter: blur(10px);
    z-index:20;
  }
  .card{
    width:min(820px, 92vw);
    padding:28px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.15);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    text-align:center;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  }
  .close-btn{
    margin-top:24px;
    padding:10px 22px;
    background:transparent;
    border:1px solid rgba(255,255,255,.35);
    color:#e8eefc;
    cursor:pointer;
    letter-spacing:.06em;
    user-select:none;
  }

  .hint{
    position:fixed;left:16px;bottom:16px;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    font-size:12px;opacity:.6;z-index:5;user-select:none;
    pointer-events:none;
  }
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro">
  <div id="stage"><div id="cloud"></div></div>
  <div class="intro-content" id="center">
    <h1>Навчання — це подорож</h1>
    <p>Перед тобою історія курсу.<br>Це лише вступ. Далі — глибше.</p>
    <button id="enterBtn">ПОЧАТИ</button>
  </div>
</div>

<div id="fadeOverlay"></div>

<!-- MAIN MAP -->
<div id="wrap">
  <div class="topbar">
    <div class="chip"><b>Карта курсу</b><span>Демо</span></div>
    <div class="chip"><span>Поки без логіну</span></div>
  </div>

  <div id="viewport">
    <div id="world">

      <svg class="path" viewBox="0 0 5200 3400" preserveAspectRatio="none">
        <line x1="900"  y1="2200" x2="1500" y2="1750"></line>
        <line x1="1500" y1="1750" x2="2100" y2="1450" class="demo-line"></line>
        <line x1="2100" y1="1450" x2="2850" y2="1200"></line>
        <line x1="2850" y1="1200" x2="3600" y2="1450"></line>
        <line x1="3600" y1="1450" x2="4100" y2="2100"></line>
      </svg>

      <!-- Nodes -->
      <div class="node locked" data-id="s1" style="left:900px;top:2200px;">
        <div class="node-label">Вступ<span class="node-meta">Закрито</span></div>
      </div>

      <div class="node locked" data-id="s2" style="left:1500px;top:1750px;">
        <div class="node-label">Період 1<span class="node-meta">Закрито</span></div>
      </div>

      <div class="node demo" id="demoNode" data-id="demo" style="left:2100px;top:1450px;">
        <div class="node-label">Демо-урок<span class="node-meta">Доступно</span></div>
      </div>

      <div class="node locked" data-id="s3" style="left:2850px;top:1200px;">
        <div class="node-label">Період 2<span class="node-meta">Закрито</span></div>
      </div>

      <div class="node locked" data-id="s4" style="left:3600px;top:1450px;">
        <div class="node-label">Період 3<span class="node-meta">Закрито</span></div>
      </div>

      <div class="node locked" data-id="s5" style="left:4100px;top:2100px;">
        <div class="node-label">Фінал<span class="node-meta">Сертифікат</span></div>
      </div>

    </div>
  </div>
</div>

<!-- DEMO MODAL -->
<div id="scene">
  <div class="card">
    <h2>Демо-урок</h2>
    <p>Це приклад формату навчання.<br>Повний шлях відкривається після входу.</p>
    <button class="close-btn" id="closeScene">Повернутись</button>
  </div>
</div>

<div class="hint">ПОЧАТИ → “занурення” → карта · Drag — рух · Коліщатко — zoom · Клік по точці — zoom-to</div>

<script>
/* ===================== INTRO YEARS (ТВОЄ) ===================== */
function makeYears(start,end){ const out=[]; for(let y=start;y<=end;y++) out.push(String(y)); return out; }
const YEARS_ALL = makeYears(1800, 2024);
const LIMIT = 170;
const YEARS = YEARS_ALL.slice(0, LIMIT);

const ORBIT_COUNT   = 56;
const SAFE_RADIUS_K = 0.23;
const ORBIT_RADIUS_K= 0.36;
const FOG_RADIUS_K  = 0.52;
const IDLE_ROT_SPEED= 0.018;

const VORTEX_MS        = 2800;
const SPIN_STRENGTH    = 2.2;
const CAMERA_PUSH      = 1650;
const CLOUD_ZOOM       = 0.22;
const TUNNEL_TIGHTEN   = 0.12;
const PASS_Z           = 2400;
const NEAR_FADE_START  = 160;
const NEAR_FADE_RANGE  = 520;

const VORTEX_ACTIVE_RATIO = 0.62;

const cloud = document.getElementById('cloud');
const stage = document.getElementById('stage');
const centerEl = document.getElementById('center');
const enterBtn = document.getElementById('enterBtn');
const intro = document.getElementById('intro');
const wrap = document.getElementById('wrap');
const fadeOverlay = document.getElementById('fadeOverlay');

function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
function smoothstep(a,b,x){
  const t = clamp((x-a)/(b-a), 0, 1);
  return t*t*(3-2*t);
}
function easeInOutCubic(x){ return x<0.5 ? 4*x*x*x : 1-Math.pow(-2*x+2,3)/2; }

let vortex=false, vortexStart=0;
let rot=0;

setTimeout(()=>{ enterBtn.style.opacity='1'; enterBtn.style.pointerEvents='auto'; }, 2000);

enterBtn.addEventListener('click', ()=>{
  if(vortex) return;
  vortex=true;
  vortexStart=performance.now();

  stage.classList.add('vortex');
  intro.classList.add('vortexing');
  enterBtn.style.pointerEvents='none';

  setTimeout(()=>{ fadeOverlay.style.opacity = '0.55'; }, 1400);
});

const items = YEARS.map((y,i)=>{
  const el=document.createElement('div');
  el.className='year';
  el.textContent=y;
  cloud.appendChild(el);

  const orbit = i < ORBIT_COUNT;
  const a0 = (i/(orbit?ORBIT_COUNT:YEARS.length))*Math.PI*2 + (Math.random()*0.12);

  return{
    el, orbit,
    a:a0,
    s:(0.45+Math.random()*0.55)*(Math.random()<0.5?-1:1),
    ph:Math.random()*Math.PI*2,
    z0: orbit ? (-80+Math.random()*180) : (-420+Math.random()*620),
    jx:(Math.random()*160-80),
    jy:(Math.random()*120-60),
    driftX:(Math.random()*2-1),
    driftY:(Math.random()*2-1),
    lastX:0,lastY:0,lastZ:0,lastScale:1,lastOp:0.1
  };
});

const vortexActiveCount = Math.floor(items.length * VORTEX_ACTIVE_RATIO);
const vortexActiveSet = new Set();
for(let i=0;i<vortexActiveCount;i++) vortexActiveSet.add(i);

let last=performance.now();
function tick(now){
  const dt=(now-last)/1000; last=now;

  const rect=centerEl.getBoundingClientRect();
  const cx=rect.left+rect.width/2;
  const cy=rect.top+rect.height/2;

  const minSide=Math.min(window.innerWidth, window.innerHeight);
  const SAFE = clamp(minSide*SAFE_RADIUS_K, 140, 240);
  const R_ORB = clamp(minSide*ORBIT_RADIUS_K, 280, 520);
  const R_FOG = clamp(minSide*FOG_RADIUS_K, 420, 860);

  const p  = vortex ? clamp((now - vortexStart)/VORTEX_MS, 0, 1) : 0;
  const pe = easeInOutCubic(p);

  const cameraZ = vortex ? (pe * CAMERA_PUSH) : 0;
  const cloudZoom = vortex ? (1 + pe*CLOUD_ZOOM) : 1;
  cloud.style.transform = `translateZ(0) scale(${cloudZoom})`;

  rot += IDLE_ROT_SPEED * dt;

  items.forEach((it,idx)=>{
    const vortexActive = !vortex || vortexActiveSet.has(idx);

    if(vortex && !vortexActive){
      it.el.style.transform =
        `translate3d(${it.lastX}px, ${it.lastY}px, ${it.lastZ}px) translate(-50%,-50%) scale(${it.lastScale})`;
      it.el.style.opacity = it.lastOp;
      return;
    }

    it.a += (IDLE_ROT_SPEED*0.85)*dt*it.s;

    const spinRamp = vortex ? smoothstep(0.10, 0.95, pe) : 0;
    const a = it.a + rot + (spinRamp * SPIN_STRENGTH) * (0.25 + idx*0.001);

    let r = it.orbit ? R_ORB : R_FOG;

    const breathe = Math.sin(now*0.00042 + it.ph) * (it.orbit ? 10 : 18);
    let x = Math.cos(a) * (r + breathe);
    let y = Math.sin(a) * (r + breathe) * 0.70;

    x += Math.sin(now*0.00020 + it.ph) * (it.orbit ? 6 : 10) * it.driftX;
    y += Math.cos(now*0.00018 + it.ph) * (it.orbit ? 5 : 9)  * it.driftY;

    if(!it.orbit){
      x += Math.sin(now*0.00017 + it.ph) * 30 + it.jx*0.10;
      y += Math.cos(now*0.00015 + it.ph) * 20 + it.jy*0.10;
    }

    const dist = Math.hypot(x,y);
    if(dist < SAFE){
      const k = SAFE / Math.max(1, dist);
      x *= k; y *= k;
    }

    if(vortex){
      const tighten = 1 - (pe * TUNNEL_TIGHTEN);
      x *= tighten;
      y *= tighten;
    }

    const zIdle = it.z0 + Math.sin(now*0.00031 + it.ph) * (it.orbit ? 18 : 34);
    const zFly = vortex ? (pe * (PASS_Z + idx*1.6)) : 0;
    const z = zIdle + zFly - cameraZ;

    const zNorm = clamp((z + 420)/1600, 0, 1);

    if(!vortex){
      const font = it.orbit ? (13 + zNorm*4) : (10 + zNorm*2);
      it.el.style.fontSize = font.toFixed(1)+'px';
      it.el.style.textShadow = it.orbit
        ? '0 0 26px rgba(106,167,255,.20), 0 0 16px rgba(0,0,0,.55)'
        : '0 0 14px rgba(0,0,0,.55)';
      it.el.style.filter = 'none';
    }

    const scaleBase = it.orbit ? (1.00 + zNorm*0.70) : (0.78 + zNorm*0.52);
    const nearBoost = vortex ? (1 + smoothstep(0.55, 0.96, pe) * 0.40) : 1;
    const scale = scaleBase * nearBoost;

    const baseOp = it.orbit
      ? clamp(0.30 + zNorm*0.55, 0.18, 0.88)
      : clamp(0.04 + zNorm*0.24, 0.02, 0.32);

    let op = baseOp;
    if(vortex){
      const t = clamp((z - NEAR_FADE_START)/NEAR_FADE_RANGE, 0, 1);
      op *= (1 - t);
    }

    const tx = cx + x;
    const ty = cy + y;

    it.el.style.opacity = op.toFixed(3);
    it.el.style.transform =
      `translate3d(${tx}px, ${ty}px, ${z}px) translate(-50%,-50%) scale(${scale})`;

    it.lastX = tx; it.lastY = ty; it.lastZ = z;
    it.lastScale = scale; it.lastOp = op.toFixed(3);
  });

  if(vortex && p>=1){
    stage.classList.remove('vortex');
    fadeOverlay.style.opacity = '1';

    setTimeout(()=>{
      intro.style.opacity='0';
      setTimeout(()=>{
        intro.style.display='none';
        wrap.style.opacity='1';
        wrap.style.pointerEvents='auto';
        fadeOverlay.style.opacity = '0';
      }, 420);
    }, 60);

    vortex=false;
    return;
  }

  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);

/* ===================== MAIN MAP (НОВА ЛОГІКА) ===================== */
const viewport = document.getElementById('viewport');
const world = document.getElementById('world');

let cam = { x: 0, y: 0, s: 1 };
let drag=false, sx=0, sy=0, startX=0, startY=0;

function applyCam(){
  world.style.transform = `translate(-50%,-50%) translate(${cam.x}px, ${cam.y}px) scale(${cam.s})`;
}

// стартова позиція камери: щоб демо було ближче до центру
cam.x = -260;
cam.y = 140;
cam.s = 1;
applyCam();

viewport.addEventListener('mousedown', (e)=>{
  drag=true;
  sx=e.clientX; sy=e.clientY;
  startX=cam.x; startY=cam.y;
});
window.addEventListener('mouseup', ()=>drag=false);
window.addEventListener('mousemove', (e)=>{
  if(!drag) return;
  cam.x = startX + (e.clientX - sx);
  cam.y = startY + (e.clientY - sy);
  applyCam();
});

viewport.addEventListener('wheel', (e)=>{
  e.preventDefault();
  const dir = e.deltaY>0 ? 0.9 : 1.1;
  cam.s = Math.max(0.45, Math.min(2.8, cam.s * dir));
  applyCam();
},{passive:false});

// Плавний zoom-to точки
function zoomToNode(nodeEl, targetScale=2.0){
  const nodeRect = nodeEl.getBoundingClientRect();
  const vr = viewport.getBoundingClientRect();

  const nx = nodeRect.left + nodeRect.width/2;
  const ny = nodeRect.top + nodeRect.height/2;

  const vx = vr.left + vr.width/2;
  const vy = vr.top + vr.height/2;

  const dx = vx - nx;
  const dy = vy - ny;

  const from = { x: cam.x, y: cam.y, s: cam.s };
  const to = { x: cam.x + dx, y: cam.y + dy, s: targetScale };

  const t0 = performance.now();
  const dur = 520;

  function anim(t){
    const p = Math.min(1, (t - t0)/dur);
    const e = p<0.5 ? 4*p*p*p : 1-Math.pow(-2*p+2,3)/2;
    cam.x = from.x + (to.x - from.x) * e;
    cam.y = from.y + (to.y - from.y) * e;
    cam.s = from.s + (to.s - from.s) * e;
    applyCam();
    if(p<1) requestAnimationFrame(anim);
  }
  requestAnimationFrame(anim);
}

// Демка + locked
const scene=document.getElementById('scene');
document.querySelectorAll('.node').forEach(n=>{
  n.addEventListener('click', ()=>{
    const id = n.getAttribute('data-id');
    zoomToNode(n, id==='demo' ? 2.1 : 1.65);

    if(id === 'demo'){
      setTimeout(()=>{ scene.style.display='flex'; }, 540);
    }else{
      setTimeout(()=>{
        alert('Цей етап доступний у повній версії.');
      }, 520);
    }
  });
});

document.getElementById('closeScene').onclick=()=>scene.style.display='none';
</script>
</body>
</html>
