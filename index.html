<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LMS — Intro + Explore</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap');

  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:#05070d;color:#e8eefc;overflow:hidden}
  button{font:inherit}

  /* ===================== INTRO (твоя стартова) ===================== */
  #intro{
    position:fixed; inset:0;
    background:
      radial-gradient(1200px 700px at 50% 40%, rgba(106,167,255,.12), transparent 55%),
      radial-gradient(900px 650px at 70% 70%, rgba(120,255,204,.06), transparent 55%),
      #05070d;
    display:flex; align-items:center; justify-content:center;
    z-index:10;
    transition: opacity 1.0s ease;
  }
  #stage{
    position:absolute; inset:0;
    perspective: 980px;
    perspective-origin: 50% 50%;
    transform-style: preserve-3d;
    overflow:hidden;
    pointer-events:none;
    contain: layout paint;
  }
  #cloud{
    position:absolute; inset:0;
    transform-style: preserve-3d;
    pointer-events:none;
    transform: translateZ(0);
    will-change: transform;
  }
  .intro-content{
    position:relative; z-index:3;
    text-align:center;
    width:min(980px,92vw);
    padding:24px;
    pointer-events:none;
    transition: opacity .65s ease, transform .65s ease, filter .65s ease;
  }
  .intro-content h1{
    font-family:"Cormorant Garamond", serif;
    font-weight:500;
    margin:0 0 14px;
    letter-spacing:.01em;
    font-size:clamp(46px,6.2vw,92px);
    line-height:1.02;
  }
  .intro-content p{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    margin:0 0 30px;
    opacity:.72;
    line-height:1.65;
    font-size:clamp(13px,1.45vw,16px);
  }
  #enterBtn{
    pointer-events:auto;
    opacity:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    font-weight:400;
    padding:12px 30px;
    background:transparent;
    border:1px solid rgba(255,255,255,.35);
    color:#e8eefc;
    letter-spacing:.18em;
    text-transform:uppercase;
    cursor:pointer;
    transition:opacity 1.2s ease,border-color .3s ease,transform .25s ease;
    user-select:none;
  }
  #enterBtn:hover{border-color:#fff;transform:translateY(-1px)}
  .year{
    position:absolute; left:0; top:0;
    transform-style:preserve-3d;
    will-change: transform, opacity;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    letter-spacing:.12em;
    color: rgba(232,238,252,.95);
    white-space:nowrap;
    user-select:none;
    pointer-events:none;
    text-shadow: 0 0 14px rgba(0,0,0,.55);
  }
  .vortex .year{ text-shadow:none !important; filter:none !important; }
  .vortexing .intro-content{
    opacity:0;
    transform: translateY(-10px) scale(0.99);
    filter: blur(1px);
  }
  #fadeOverlay{
    position:fixed; inset:0;
    background:#05070d;
    opacity:0;
    pointer-events:none;
    z-index:15;
    transition: opacity .6s ease;
  }

  /* ===================== MAIN: Explore grid-map (як 100lostspecies) ===================== */
  #explore{
    position:fixed; inset:0;
    opacity:0;
    pointer-events:none;
    transition:opacity 1s ease;
    z-index:1;
    background:
      radial-gradient(1200px 800px at 50% 55%, rgba(0,0,0,.08), rgba(0,0,0,.70) 70%),
      #f4f2ee; /* світлий "папір" */
    color:#0b0e14;
  }

  /* Верхні чіпи */
  .topbar{
    position:absolute; left:14px; right:14px; top:14px;
    display:flex; align-items:center; justify-content:space-between;
    gap:12px;
    z-index:5;
    pointer-events:none;
  }
  .chip{
    pointer-events:auto;
    display:flex; align-items:center; gap:10px;
    padding:10px 12px;
    border:1px solid rgba(0,0,0,.12);
    border-radius:999px;
    background:rgba(255,255,255,.70);
    backdrop-filter: blur(10px);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    color:#0b0e14;
  }
  .chip b{font-size:13px; letter-spacing:.02em; font-weight:600}
  .chip span{font-size:12px; opacity:.65}

  /* Viewport */
  #viewport{
    position:absolute; inset:0;
    overflow:hidden;
    cursor:grab;
  }
  #viewport:active{ cursor:grabbing; }

  /* “Світ” */
  #world{
    position:absolute;
    left:50%; top:50%;
    width:5200px; height:3400px;
    transform: translate(-50%,-50%) translate(0px,0px) scale(1);
    transform-origin: 0 0;
    will-change: transform;
  }

  /* легкі “пил/зерно” точки */
  #world::before{
    content:"";
    position:absolute; inset:0;
    background:
      radial-gradient(circle at 1px 1px, rgba(0,0,0,.11) 1px, transparent 1px);
    background-size: 58px 58px;
    opacity:.08;
    pointer-events:none;
  }

  /* Center Explore button */
  #centerButton{
    position:absolute;
    left:2600px; top:1700px;
    transform: translate(-50%,-50%);
    z-index:2;
    display:flex; align-items:center; justify-content:center;
    pointer-events:auto;
  }
  #exploreBtn{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    font-size:12px;
    letter-spacing:.12em;
    text-transform:uppercase;
    padding:10px 14px;
    border-radius:0;
    border:1px solid rgba(0,0,0,.65);
    background:#0b0e14;
    color:#fff;
    cursor:pointer;
    box-shadow: 0 12px 30px rgba(0,0,0,.12);
    user-select:none;
  }

  /* Cards */
  .card{
    position:absolute;
    width:260px;
    height:190px;
    border-radius:6px;
    background:#fff;
    box-shadow:
      0 22px 50px rgba(0,0,0,.10),
      0 8px 14px rgba(0,0,0,.08);
    overflow:hidden;
    transform: translate(-50%,-50%) rotate(var(--r,0deg));
    transform-origin:center;
    cursor:pointer;
    user-select:none;
  }
  .card::after{
    content:"";
    position:absolute; inset:0;
    background: radial-gradient(700px 260px at 50% 40%, rgba(0,0,0,0), rgba(0,0,0,.06));
    pointer-events:none;
  }
  .art{
    position:absolute; inset:0;
    background:
      radial-gradient(220px 180px at 30% 30%, rgba(120,255,204,.35), transparent 60%),
      radial-gradient(260px 220px at 70% 70%, rgba(106,167,255,.30), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.70));
    filter: saturate(1.05);
    transform: scale(1.02);
  }
  .card[data-img] .art{
    background-image: var(--img);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  .label{
    position:absolute; left:12px; right:12px; bottom:10px;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    font-size:12px;
    letter-spacing:.02em;
    color:rgba(0,0,0,.75);
    display:flex; align-items:baseline; justify-content:space-between; gap:10px;
    text-shadow: 0 1px 0 rgba(255,255,255,.6);
    pointer-events:none;
  }
  .label b{font-weight:600}
  .label i{font-style:normal; opacity:.55; font-size:11px}

  /* Hover */
  .card:hover{
    box-shadow:
      0 30px 70px rgba(0,0,0,.14),
      0 10px 18px rgba(0,0,0,.10);
  }

  /* DEMO SCENE MODAL */
  #scene{
    position:fixed; inset:0;
    display:none;
    align-items:center; justify-content:center;
    background: rgba(10,12,18,.65);
    backdrop-filter: blur(10px);
    z-index:30;
  }
  .modal{
    width:min(820px, 92vw);
    padding:28px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.18);
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    color:#e8eefc;
    text-align:center;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  }
  .modal h2{margin:0 0 10px; font-size:20px}
  .modal p{margin:0 0 18px; opacity:.78; line-height:1.6}
  .btn{
    padding:10px 18px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.25);
    background:transparent;
    color:#e8eefc;
    cursor:pointer;
  }
  .btn.primary{
    border-color: rgba(106,167,255,.55);
    background: rgba(106,167,255,.14);
  }

  .hint{
    position:fixed; left:16px; bottom:16px;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    font-size:12px; opacity:.55;
    z-index:5;
    user-select:none;
    pointer-events:none;
    color:rgba(0,0,0,.65);
  }
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro">
  <div id="stage"><div id="cloud"></div></div>
  <div class="intro-content" id="center">
    <h1>Навчання — це подорож</h1>
    <p>Перед тобою історія курсу.<br>Це лише вступ. Далі — глибше.</p>
    <button id="enterBtn">ПОЧАТИ</button>
  </div>
</div>
<div id="fadeOverlay"></div>

<!-- MAIN Explore -->
<div id="explore">
  <div class="topbar">
    <div class="chip"><b>Карта курсу</b><span>Демо</span></div>
    <div class="chip"><span>Поки без логіну</span></div>
  </div>

  <div id="viewport">
    <div id="world">

      <!-- Center Explore -->
      <div id="centerButton">
        <button id="exploreBtn">Explore</button>
      </div>

      <!-- Cards (позиції у великому світі) -->
      <div class="card" data-id="c1" style="left:1400px;top:900px;--r:-6deg">
        <div class="art"></div>
        <div class="label"><b>Етап 1</b><i>Locked</i></div>
      </div>

      <div class="card" data-id="c2" style="left:2100px;top:780px;--r:4deg">
        <div class="art"></div>
        <div class="label"><b>Етап 2</b><i>Locked</i></div>
      </div>

      <div class="card" data-id="demo" style="left:2600px;top:1080px;--r:-2deg">
        <div class="art"></div>
        <div class="label"><b>Демо-урок</b><i>Open</i></div>
      </div>

      <div class="card" data-id="c3" style="left:3180px;top:820px;--r:6deg">
        <div class="art"></div>
        <div class="label"><b>Етап 3</b><i>Locked</i></div>
      </div>

      <div class="card" data-id="c4" style="left:3800px;top:980px;--r:-5deg">
        <div class="art"></div>
        <div class="label"><b>Фінал</b><i>Certificate</i></div>
      </div>

      <div class="card" data-id="c5" style="left:1850px;top:1750px;--r:7deg">
        <div class="art"></div>
        <div class="label"><b>Тема</b><i>Locked</i></div>
      </div>

      <div class="card" data-id="c6" style="left:3150px;top:1950px;--r:-7deg">
        <div class="art"></div>
        <div class="label"><b>Тема</b><i>Locked</i></div>
      </div>

    </div>
  </div>

  <div class="hint">Drag — рух · Коліщатко — zoom · Клік по картці — фокус</div>
</div>

<!-- Modal -->
<div id="scene">
  <div class="modal">
    <h2>Демо-урок</h2>
    <p>Це демо-сцена. Тут буде контент уроку, тест і “Завершити”.</p>
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
      <button class="btn" id="closeScene">Назад</button>
      <button class="btn primary" id="finishDemo">Завершити демо</button>
    </div>
  </div>
</div>

<script>
/* ===================== INTRO YEARS (твоя логіка) ===================== */
function makeYears(start,end){ const out=[]; for(let y=start;y<=end;y++) out.push(String(y)); return out; }
const YEARS_ALL = makeYears(1800, 2024);
const LIMIT = 170;
const YEARS = YEARS_ALL.slice(0, LIMIT);

const ORBIT_COUNT   = 56;
const SAFE_RADIUS_K = 0.23;
const ORBIT_RADIUS_K= 0.36;
const FOG_RADIUS_K  = 0.52;
const IDLE_ROT_SPEED= 0.018;

const VORTEX_MS        = 2800;
const SPIN_STRENGTH    = 2.2;
const CAMERA_PUSH      = 1650;
const CLOUD_ZOOM       = 0.22;
const TUNNEL_TIGHTEN   = 0.12;
const PASS_Z           = 2400;
const NEAR_FADE_START  = 160;
const NEAR_FADE_RANGE  = 520;

const VORTEX_ACTIVE_RATIO = 0.62;

const cloud = document.getElementById('cloud');
const stage = document.getElementById('stage');
const centerEl = document.getElementById('center');
const enterBtn = document.getElementById('enterBtn');
const intro = document.getElementById('intro');
const explore = document.getElementById('explore');
const fadeOverlay = document.getElementById('fadeOverlay');

function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
function smoothstep(a,b,x){
  const t = clamp((x-a)/(b-a), 0, 1);
  return t*t*(3-2*t);
}
function easeInOutCubic(x){ return x<0.5 ? 4*x*x*x : 1-Math.pow(-2*x+2,3)/2; }

let vortex=false, vortexStart=0;
let rot=0;

setTimeout(()=>{ enterBtn.style.opacity='1'; enterBtn.style.pointerEvents='auto'; }, 2000);

enterBtn.addEventListener('click', ()=>{
  if(vortex) return;
  vortex=true;
  vortexStart=performance.now();

  stage.classList.add('vortex');
  intro.classList.add('vortexing');
  enterBtn.style.pointerEvents='none';

  setTimeout(()=>{ fadeOverlay.style.opacity = '0.55'; }, 1400);
});

const items = YEARS.map((y,i)=>{
  const el=document.createElement('div');
  el.className='year';
  el.textContent=y;
  cloud.appendChild(el);

  const orbit = i < ORBIT_COUNT;
  const a0 = (i/(orbit?ORBIT_COUNT:YEARS.length))*Math.PI*2 + (Math.random()*0.12);

  return{
    el, orbit,
    a:a0,
    s:(0.45+Math.random()*0.55)*(Math.random()<0.5?-1:1),
    ph:Math.random()*Math.PI*2,
    z0: orbit ? (-80+Math.random()*180) : (-420+Math.random()*620),
    jx:(Math.random()*160-80),
    jy:(Math.random()*120-60),
    driftX:(Math.random()*2-1),
    driftY:(Math.random()*2-1),
    lastX:0,lastY:0,lastZ:0,lastScale:1,lastOp:0.1
  };
});

const vortexActiveCount = Math.floor(items.length * VORTEX_ACTIVE_RATIO);
const vortexActiveSet = new Set();
for(let i=0;i<vortexActiveCount;i++) vortexActiveSet.add(i);

let last=performance.now();
function tick(now){
  const dt=(now-last)/1000; last=now;

  const rect=centerEl.getBoundingClientRect();
  const cx=rect.left+rect.width/2;
  const cy=rect.top+rect.height/2;

  const minSide=Math.min(window.innerWidth, window.innerHeight);
  const SAFE = clamp(minSide*SAFE_RADIUS_K, 140, 240);
  const R_ORB = clamp(minSide*ORBIT_RADIUS_K, 280, 520);
  const R_FOG = clamp(minSide*FOG_RADIUS_K, 420, 860);

  const p  = vortex ? clamp((now - vortexStart)/VORTEX_MS, 0, 1) : 0;
  const pe = easeInOutCubic(p);

  const cameraZ = vortex ? (pe * CAMERA_PUSH) : 0;
  const cloudZoom = vortex ? (1 + pe*CLOUD_ZOOM) : 1;
  cloud.style.transform = `translateZ(0) scale(${cloudZoom})`;

  rot += IDLE_ROT_SPEED * dt;

  items.forEach((it,idx)=>{
    const vortexActive = !vortex || vortexActiveSet.has(idx);

    if(vortex && !vortexActive){
      it.el.style.transform =
        `translate3d(${it.lastX}px, ${it.lastY}px, ${it.lastZ}px) translate(-50%,-50%) scale(${it.lastScale})`;
      it.el.style.opacity = it.lastOp;
      return;
    }

    it.a += (IDLE_ROT_SPEED*0.85)*dt*it.s;

    const spinRamp = vortex ? smoothstep(0.10, 0.95, pe) : 0;
    const a = it.a + rot + (spinRamp * SPIN_STRENGTH) * (0.25 + idx*0.001);

    let r = it.orbit ? R_ORB : R_FOG;

    const breathe = Math.sin(now*0.00042 + it.ph) * (it.orbit ? 10 : 18);
    let x = Math.cos(a) * (r + breathe);
    let y = Math.sin(a) * (r + breathe) * 0.70;

    x += Math.sin(now*0.00020 + it.ph) * (it.orbit ? 6 : 10) * it.driftX;
    y += Math.cos(now*0.00018 + it.ph) * (it.orbit ? 5 : 9)  * it.driftY;

    if(!it.orbit){
      x += Math.sin(now*0.00017 + it.ph) * 30 + it.jx*0.10;
      y += Math.cos(now*0.00015 + it.ph) * 20 + it.jy*0.10;
    }

    const dist = Math.hypot(x,y);
    if(dist < SAFE){
      const k = SAFE / Math.max(1, dist);
      x *= k; y *= k;
    }

    if(vortex){
      const tighten = 1 - (pe * TUNNEL_TIGHTEN);
      x *= tighten;
      y *= tighten;
    }

    const zIdle = it.z0 + Math.sin(now*0.00031 + it.ph) * (it.orbit ? 18 : 34);
    const zFly = vortex ? (pe * (PASS_Z + idx*1.6)) : 0;
    const z = zIdle + zFly - cameraZ;

    const zNorm = clamp((z + 420)/1600, 0, 1);

    if(!vortex){
      const font = it.orbit ? (13 + zNorm*4) : (10 + zNorm*2);
      it.el.style.fontSize = font.toFixed(1)+'px';
      it.el.style.textShadow = it.orbit
        ? '0 0 26px rgba(106,167,255,.20), 0 0 16px rgba(0,0,0,.55)'
        : '0 0 14px rgba(0,0,0,.55)';
      it.el.style.filter = 'none';
    }

    const scaleBase = it.orbit ? (1.00 + zNorm*0.70) : (0.78 + zNorm*0.52);
    const nearBoost = vortex ? (1 + smoothstep(0.55, 0.96, pe) * 0.40) : 1;
    const scale = scaleBase * nearBoost;

    const baseOp = it.orbit
      ? clamp(0.30 + zNorm*0.55, 0.18, 0.88)
      : clamp(0.04 + zNorm*0.24, 0.02, 0.32);

    let op = baseOp;
    if(vortex){
      const t = clamp((z - NEAR_FADE_START)/NEAR_FADE_RANGE, 0, 1);
      op *= (1 - t);
    }

    const tx = cx + x;
    const ty = cy + y;

    it.el.style.opacity = op.toFixed(3);
    it.el.style.transform =
      `translate3d(${tx}px, ${ty}px, ${z}px) translate(-50%,-50%) scale(${scale})`;

    it.lastX = tx; it.lastY = ty; it.lastZ = z;
    it.lastScale = scale; it.lastOp = op.toFixed(3);
  });

  if(vortex && p>=1){
    stage.classList.remove('vortex');
    fadeOverlay.style.opacity = '1';

    setTimeout(()=>{
      intro.style.opacity='0';
      setTimeout(()=>{
        intro.style.display='none';
        explore.style.opacity='1';
        explore.style.pointerEvents='auto';
        fadeOverlay.style.opacity = '0';
      }, 420);
    }, 60);

    vortex=false;
    return;
  }

  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);

/* ===================== EXPLORE MAP (pan/zoom + drift like reference) ===================== */
const viewport = document.getElementById('viewport');
const world = document.getElementById('world');

let cam = { x: 0, y: 0, s: 1 };
let drag=false, sx=0, sy=0, startX=0, startY=0;

// інерція (як мапа)
let vx=0, vy=0;
const FRICTION = 0.92;

function applyCam(){
  world.style.transform = `translate(-50%,-50%) translate(${cam.x}px, ${cam.y}px) scale(${cam.s})`;
}

// старт: так щоб центр з Explore був в кадрі
cam.x = 0;
cam.y = 0;
cam.s = 1;
applyCam();

viewport.addEventListener('mousedown', (e)=>{
  drag=true;
  sx=e.clientX; sy=e.clientY;
  startX=cam.x; startY=cam.y;
  vx=0; vy=0;
});
window.addEventListener('mouseup', ()=>{
  drag=false;
});
window.addEventListener('mousemove', (e)=>{
  if(!drag) return;
  const dx = (e.clientX - sx);
  const dy = (e.clientY - sy);
  cam.x = startX + dx;
  cam.y = startY + dy;
  vx = dx; vy = dy;
  applyCam();
});

viewport.addEventListener('wheel', (e)=>{
  e.preventDefault();
  const dir = e.deltaY>0 ? 0.92 : 1.08;
  const next = Math.max(0.45, Math.min(2.6, cam.s * dir));
  cam.s = next;
  applyCam();
},{passive:false});

// Drift cards (легкий дрейф як у референсі)
const cards = Array.from(document.querySelectorAll('.card')).map((el, i)=>({
  el,
  baseX: parseFloat(el.style.left),
  baseY: parseFloat(el.style.top),
  ph: Math.random()*Math.PI*2,
  a: 0.35 + Math.random()*0.65,
  sx: (Math.random()<0.5?-1:1) * (0.6 + Math.random()*0.8),
  sy: (Math.random()<0.5?-1:1) * (0.6 + Math.random()*0.8),
}));

function driftTick(t){
  // inertial glide when mouse released
  if(!drag){
    cam.x += vx*0.06;
    cam.y += vy*0.06;
    vx *= FRICTION;
    vy *= FRICTION;
    if(Math.abs(vx)+Math.abs(vy) > 0.2) applyCam();
  }

  cards.forEach((c, idx)=>{
    const dx = Math.sin(t*0.00025 + c.ph) * (10*c.a) * c.sx;
    const dy = Math.cos(t*0.00022 + c.ph) * (8*c.a)  * c.sy;
    const wob = Math.sin(t*0.00018 + c.ph) * (0.8*c.a);

    c.el.style.left = (c.baseX + dx) + 'px';
    c.el.style.top  = (c.baseY + dy) + 'px';
    c.el.style.setProperty('--r', (parseFloat(getComputedStyle(c.el).getPropertyValue('--r')) || 0) + wob + 'deg');
  });

  requestAnimationFrame(driftTick);
}
requestAnimationFrame(driftTick);

/* Click behavior: focus & open demo */
function zoomToWorldPoint(wx, wy, targetScale=1.35){
  // перетворення: світ (5200x3400) знаходиться в центрі, translate(-50%,-50%) + cam
  // Ми рухаємо cam так, щоб точка (wx,wy) була по центру viewport.
  const vr = viewport.getBoundingClientRect();
  const vxCenter = vr.width/2;
  const vyCenter = vr.height/2;

  // поточна позиція world в екранних координатах:
  // world left/top = center + cam, але ми керуємо cam напряму, тому робимо анімацію до потрібного cam.
  // Якщо точка світу wx,wy: її екранна позиція = center + cam + ( (wx - 2600) * scale, (wy - 1700) * scale )
  // Тому нам треба cam таку, щоб ця позиція стала рівно центру viewport.
  const from = { x: cam.x, y: cam.y, s: cam.s };
  const toS = targetScale;

  const dxWorld = (wx - 2600) * toS;
  const dyWorld = (wy - 1700) * toS;

  const to = {
    s: toS,
    x: (vxCenter - dxWorld) - (viewport.getBoundingClientRect().left + vxCenter - (viewport.getBoundingClientRect().left + vxCenter)) + 0,
    y: (vyCenter - dyWorld) - (viewport.getBoundingClientRect().top + vyCenter - (viewport.getBoundingClientRect().top + vyCenter)) + 0,
  };

  // Простіше: нам не треба абсолютні left/top, бо cam застосовується до world в його системі,
  // Тому формула: cam.x = -(wx-2600)*s ; cam.y = -(wy-1700)*s
  to.x = -(wx - 2600) * toS;
  to.y = -(wy - 1700) * toS;

  const t0 = performance.now();
  const dur = 520;

  function anim(t){
    const p = Math.min(1, (t - t0)/dur);
    const e = p<0.5 ? 4*p*p*p : 1-Math.pow(-2*p+2,3)/2;
    cam.x = from.x + (to.x - from.x) * e;
    cam.y = from.y + (to.y - from.y) * e;
    cam.s = from.s + (to.s - from.s) * e;
    applyCam();
    if(p<1) requestAnimationFrame(anim);
  }
  requestAnimationFrame(anim);
}

const scene = document.getElementById('scene');
document.querySelectorAll('.card').forEach(card=>{
  card.addEventListener('click', ()=>{
    const id = card.getAttribute('data-id');
    const wx = parseFloat(card.style.left);
    const wy = parseFloat(card.style.top);

    zoomToWorldPoint(wx, wy, id==='demo' ? 1.6 : 1.35);

    if(id==='demo'){
      setTimeout(()=>{ scene.style.display='flex'; }, 560);
    }else{
      setTimeout(()=>{ alert('Цей етап доступний у повній версії.'); }, 420);
    }
  });
});

document.getElementById('closeScene').onclick = ()=> scene.style.display='none';
document.getElementById('finishDemo').onclick = ()=>{
  scene.style.display='none';
  alert('Демо завершено ✅');
};

document.getElementById('exploreBtn').onclick = ()=>{
  // легкий "focus" в центр — як відчуття кнопки Explore
  zoomToWorldPoint(2600, 1700, 1.15);
};
</script>

</body>
</html>
